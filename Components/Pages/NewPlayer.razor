@page "/new-player"
@inject NavigationManager Navigation
@inject PlayerState PlayerState

<h1>New Player</h1>

<div style="margin-bottom: 1rem;">
    <button @onclick="GoBack">Back</button>
</div>

<div style="margin-bottom: 1rem;">
    <label for="playerName" style="display: block; margin-bottom: 0.25rem;">Player Name:</label>
    <input id="playerName" type="text" @bind="playerName" @bind:event="oninput" 
           style="padding: 0.5rem; font-size: 1rem; width: 200px;" 
           placeholder="Enter your name" />
</div>

<table>
    <thead>
        <tr>
            <th>Stat</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr><td>Stamina</td><td><input type="number" @bind="currentStats.Stamina" min="1" max="99" style="width: 60px;" /></td></tr>
        <tr><td>Charisma</td><td><input type="number" @bind="currentStats.Charisma" min="1" max="99" style="width: 60px;" /></td></tr>
        <tr><td>Strength</td><td><input type="number" @bind="currentStats.Strength" min="1" max="99" style="width: 60px;" /></td></tr>
        <tr><td>Intelligence</td><td><input type="number" @bind="currentStats.Intelligence" min="1" max="99" style="width: 60px;" /></td></tr>
        <tr><td>Wisdom</td><td><input type="number" @bind="currentStats.Wisdom" min="1" max="99" style="width: 60px;" /></td></tr>
        <tr><td>Skill</td><td><input type="number" @bind="currentStats.Skill" min="1" max="99" style="width: 60px;" /></td></tr>
        <tr><td>Speed</td><td><input type="number" @bind="currentStats.Speed" min="1" max="99" style="width: 60px;" /></td></tr>
    </tbody>
</table>

<div style="margin-top: 1rem; display: flex; gap: 1rem;">
    <button @onclick="Respin">Respin</button>
    <button @onclick="Select">Select</button>
</div>

@code {
    private PlayerStats currentStats = new();
    private string playerName = "Adventurer";
    private static readonly Random Random = new();

    protected override void OnInitialized()
    {
        RollStats();
    }

    private void RollStats()
    {
        currentStats = new PlayerStats
        {
            Stamina = Roll(),
            Charisma = Roll(),
            Strength = Roll(),
            Intelligence = Roll(),
            Wisdom = Roll(),
            Skill = Roll(),
            Speed = Roll()
        };
    }

    private int Roll() => Random.Next(5, 22);

    private void Respin()
    {
        RollStats();
    }

    private void Select()
    {
        currentStats.Name = string.IsNullOrWhiteSpace(playerName) ? "Adventurer" : playerName.Trim();
        PlayerState.SetStats(currentStats);
        Navigation.NavigateTo("/game");
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/");
    }
}
