@page "/game"
@inject IJSRuntime JSRuntime
@inject PlayerState PlayerState

<div id="game-container" style="width: 100%; height: 100%; overflow: hidden; margin: 0; padding: 0; position: relative;">
    <div id="stats-overlay" style="position: absolute; top: 10px; left: 10px; color: white; background: rgba(0, 0, 0, 0.5); padding: 10px; font-family: monospace; pointer-events: none; user-select: none;">
        Loading Stats...
    </div>
    <div id="hit-flash" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 10px solid red; box-sizing: border-box; pointer-events: none; opacity: 0; transition: opacity 0.1s;"></div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            object? statsArg = null;

            if (PlayerState.HasStats && PlayerState.Stats is not null)
            {
                statsArg = new
                {
                    Strength = PlayerState.Stats.Strength,
                    Stamina = PlayerState.Stats.Stamina,
                    Agility = PlayerState.Stats.Agility,
                    Constitution = PlayerState.Stats.Constitution,
                    Intelligence = PlayerState.Stats.Intelligence,
                    Wisdom = PlayerState.Stats.Wisdom,
                    Experience = PlayerState.Stats.Experience,
                    Speed = PlayerState.Stats.Speed
                };
            }

            await JSRuntime.InvokeVoidAsync("window.game.initGame", "game-container", statsArg);
        }
    }
}
